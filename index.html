<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="styles/gdd.mobile.min.css" rel="stylesheet" />
    <link href="styles/jquery.mobile.structure-1.3.0.min.css" rel="stylesheet" />
    <script src="scripts/jquery-1.10.2.min.js"></script>
    <script src="scripts/jquery.mobile-1.3.0.min.js"></script>
    <script type="text/javascript" src="PushNotification.js"></script>

    <script type="text/javascript" charset="utf-8">
        window.gdd = window.gdd || {};
        window.GCMRegID = "None";
      

        $(document).ready(function () {
            $("#btnClickMe").on("click", function () {
                alert("Your GCMRegID is: " + window.GCMRegID);
            });

            $("#GCMRegID").html(window.GCMRegID);
        });


        // Wait for Cordova to load
        function indexPageLoaded() {
             alert("index onload called")
            document.addEventListener("deviceready", onDeviceReady, false);

        }

        // Cordova is ready
        function onDeviceReady() {
             alert("Device ready has fired yes:")
            //navigator.splashscreen.hide();
            //window.gdd = window.gdd || {};

            try {

               
                var pushNotification = window.plugins.pushNotification;
                alert("got ref to push notification")

                pushNotification.register(pushNotifySuccess, pushNotifyFail, { "senderID": "385529235062", "ecb": "onNotificationGCM" });


                alert("push notifiy has registered")

             
                document.addEventListener("resume", onAppResume, false);

                document.addEventListener("menubutton", onMenuKeyDown, false);

                document.addEventListener("offline", wentOffline, false);

                document.addEventListener("online", wentOnline, false);
                alert("add event listeners complete")

            }
            catch (err) {
                alert("The following error occured during the onDeviceReady event: " + err + ". Please check you are connected to the Internet and try again.")
            }

        }

        // result contains any message sent from the plugin call
       function pushNotifySuccess(result) {
            alert('Push Notify Callback Success! Result = '+result)
       }

       function  pushNotifyFail(error) {
            alert("Push Notify Reg has failed with this error: " + error);
       }

      


       function onNotificationGCM(e) {
           alert("Got a message");
           alert(JSON.stringify(e));
            switch( e.event )
            {
                case 'registered':
                    if ( e.regid.length > 0 )
                    {
                        window.GCMRegID = e.regid;
                        $("#GCMRegID").html(window.GCMRegID);
                        //console.log("Regid " + e.regid);
                        alert('registration id = '+ e.regid);
                    }
                    break;
 
                case 'message':
                    // this is the actual push notification. its format depends on the data model from the push server
                    alert('message = '+e.message+' msgcnt = '+e.msgcnt);
                    break;
 
                case 'error':
                    alert('GCM error = '+e.msg);
                    break;
 
                default:
                    alert('An unknown GCM event has occurred');
                    break;
            }
        }












        function onAppResume() {
            try {
                 alert("App Resume event fired")
               
            }
            catch (err) {
                alert("Error onAppResume: " + err)
            }
        }

        function wentOnline() {
            try {
                 alert("Online fired")

               
            }
            catch (err) {
                alert("Error occured when app came online: " + err)
            }

        }

        function wentOffline() {
            try {
                 alert("offline fired")
                

            }
            catch (err) {

                alert("The following occurred when app went offline: " + err)
            }

        }


        function onMenuKeyDown() {
            try {
                 alert("home key was pressed")
            }
            catch (err) {

            }

        };



    </script>


</head>
<body onload="indexPageLoaded();">

    <div data-role="page" data-theme="a" id="pg_index">
        <div data-role="header">
            <h3>Test App</h3>
        </div>

        <div data-role="content">
            <p class="ui-content ui-body-c">This is a simple app used to test aspects of the Android and iOS messaging services. Project ID: 385529235062</p>
            <a href="#" data-theme="b" id="btnClickMe" data-role="button">GCM RegID</a>
            <div id="GCMRegID"></div>
        </div>

        <div data-role="footer">
            <h4>Page Footer</h4>
        </div>


    </div>

</body>
    <script type="text/javascript" src="cordova.js"></script>

</html>
